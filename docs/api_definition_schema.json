{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://xplatter.dev/schemas/api-definition/v1",
  "title": "xplatter API Definition",
  "description": "Schema for xplatter API definition YAML files.",
  "type": "object",
  "required": ["api", "flatbuffers", "interfaces"],
  "additionalProperties": false,
  "properties": {
    "api": { "$ref": "#/$defs/api_metadata" },
    "flatbuffers": {
      "type": "array",
      "items": { "type": "string", "pattern": "\\.fbs$" },
      "minItems": 1
    },
    "handles": {
      "type": "array",
      "items": { "$ref": "#/$defs/handle_definition" }
    },
    "interfaces": {
      "type": "array",
      "items": { "$ref": "#/$defs/interface_definition" },
      "minItems": 1
    }
  },
  "$defs": {
    "api_metadata": {
      "type": "object",
      "required": ["name", "version", "impl_lang"],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string", "pattern": "^[a-z][a-z0-9_]*$" },
        "version": { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+$" },
        "description": { "type": "string" },
        "impl_lang": { "type": "string", "enum": ["cpp", "rust", "go", "c"] },
        "targets": {
          "type": "array",
          "items": { "type": "string", "enum": ["android", "ios", "web", "windows", "macos", "linux"] },
          "minItems": 1,
          "uniqueItems": true
        }
      }
    },
    "handle_definition": {
      "type": "object",
      "required": ["name"],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string", "pattern": "^[A-Z][a-zA-Z0-9]*$" },
        "description": { "type": "string" }
      }
    },
    "interface_definition": {
      "type": "object",
      "required": ["name"],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string", "pattern": "^[a-z][a-z0-9_]*$" },
        "description": { "type": "string" },
        "constructors": {
          "type": "array",
          "items": { "$ref": "#/$defs/constructor_definition" },
          "minItems": 1
        },
        "methods": {
          "type": "array",
          "items": { "$ref": "#/$defs/method_definition" },
          "minItems": 1
        }
      }
    },
    "constructor_definition": {
      "type": "object",
      "required": ["name", "returns", "error"],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string", "pattern": "^create(_[a-z][a-z0-9_]*)?$" },
        "description": { "type": "string" },
        "parameters": {
          "type": "array",
          "items": { "$ref": "#/$defs/parameter_definition" }
        },
        "returns": { "$ref": "#/$defs/return_definition" },
        "error": { "type": "string", "pattern": "^[A-Z][a-zA-Z0-9]*(\\.[A-Z][a-zA-Z0-9]*)*$" }
      }
    },
    "method_definition": {
      "type": "object",
      "required": ["name"],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string", "pattern": "^[a-z][a-z0-9_]*$" },
        "description": { "type": "string" },
        "parameters": {
          "type": "array",
          "items": { "$ref": "#/$defs/parameter_definition" }
        },
        "returns": { "$ref": "#/$defs/return_definition" },
        "error": { "type": "string", "pattern": "^[A-Z][a-zA-Z0-9]*(\\.[A-Z][a-zA-Z0-9]*)*$" }
      }
    },
    "parameter_definition": {
      "type": "object",
      "required": ["name", "type"],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string", "pattern": "^[a-z][a-z0-9_]*$" },
        "type": {
          "type": "string",
          "pattern": "^(int8|int16|int32|int64|uint8|uint16|uint32|uint64|float32|float64|bool|string|buffer<(int8|int16|int32|int64|uint8|uint16|uint32|uint64|float32|float64)>|handle:[A-Z][a-zA-Z0-9]*|[A-Z][a-zA-Z0-9]*(\\.[A-Z][a-zA-Z0-9]*)*)$"
        },
        "transfer": { "type": "string", "enum": ["value", "ref", "ref_mut"] },
        "description": { "type": "string" }
      }
    },
    "return_definition": {
      "type": "object",
      "required": ["type"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "pattern": "^(int8|int16|int32|int64|uint8|uint16|uint32|uint64|float32|float64|bool|handle:[A-Z][a-zA-Z0-9]*|[A-Z][a-zA-Z0-9]*(\\.[A-Z][a-zA-Z0-9]*)*)$"
        },
        "description": { "type": "string" }
      }
    }
  }
}
